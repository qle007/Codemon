<canvas id="ctx" width="800" height="400" style="border:1px solid #000000;"></canvas>
<img id="image"  src="https://t4.rbxcdn.com/62bbee6270c1fd87433471fce981285b" hidden="true">
<img id="image2"  src="https://c-7npsfqifvt34x24hvjeftnfejbx2ejhox2edpn.g00.ign.com/g00/3_c-7x78x78x78.jho.dpn_/c-7NPSFQIFVT34x24iuuqx3ax2fx2fhvjeftnfejb.jho.dpnx2fhvjeftx2f160798x2fjnbhftx2fcmbdlx78ijufx2fqplfnbot_247.hjgx3fj21d.nbslx3djnbhf_$/$/$/$/$/$" hidden="true">
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.5/socket.io.min.js"></script>
<script>
    var ctx = document.getElementById("ctx").getContext("2d");
    var img = document.getElementById("image");
    var img2 = document.getElementById("image2");
    ctx.font = '30px Arial'
    var socket = io()
    socket.on("startingPos", (data) => {

        ctx.clearRect(0, 0, 1200, 700)
        for (var i = 0; i < data.length > 0; i++) {
            if (data[i].id == 0) {
                console.log(data[i].x, data[i].y)
                ctx.drawImage(image, data[i].x, data[i].y,200,200);
                ctx.fillText("Pythachu",data[i].x + 50, 360);
                drawHealthbar(ctx,0,0,350,50,data[i].health.current,data[i].health.total);
                ctx.fillText("" + data[i].health.current + "/" + data[i].health.total, data[i].x + 50, 100);
            }
            else{
                ctx.fillText("Flarebase", data[i].x + 50, 360);
                drawHealthbar(ctx,data[i].x,0,350,50,data[i].health.current,data[i].health.total);
                ctx.fillText("" + data[i].health.current + "/" + data[i].health.total, data[i].x + 50, 100);
                ctx.drawImage(image2, data[i].x, data[i].y,300,300);               
            }
        }
    })
    function submitCode(){
        var userCode = document.getElementById("userInput").value;
        setInterval(function(){
            socket.emit('attack', userCode);
        })
    }
    function drawHealthbar(canvas,x,y,width,height,health,max_health){
	    if(health>=max_health){health=max_health;}
	    if(health<=0){health = 0;}
	    canvas.fillStyle = '#0000000';
	    canvas.fillRect(x,y,width,height);
	    var colorNumber = Math.round((1-(health/max_health))*0xff)*0x10000+Math.round((health/max_health)*0xff)*0x100;
	    var colorString = colorNumber.toString(16);
	    if(colorNumber>= 0x100000){
	        canvas.fillStyle = '#'+colorString;
	    }else if (colorNumber << 0x100000 && colorNumber >= 0x100000){
		    canvas.fillStyle = '#0'+colorString;
	    }else if (colorNumber << 0x10000) {
		    canvas.fillStyle = '#00'+colorString;
		}
	    canvas.fillRect(x+1,y+1,(health/max_health)*(width-2),height-2);
    }
</script>
<input type="text" id="instructions"  readOnly="true">
<textarea id="userInput"> </textarea>
<button type="button" onclick="submitCode()">Submit</button>
